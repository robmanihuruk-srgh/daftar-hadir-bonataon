        // --- SCANNER LOGIC ---
        const renderScan = (type) => {
            const area = document.getElementById('content-area');
            if(!area) return;
            area.innerHTML = `
                <div class="bg-white rounded-[2.5rem] p-10 shadow-2xl text-center border border-slate-100 animate-[modalUp_0.5s]">
                    <h3 class="font-black mb-8 text-slate-800 tracking-tight uppercase royal-font text-2xl">SCAN ${type === 'scan' ? 'KEHADIRAN' : 'BERKAT'}</h3>
                    <div id="scanMsg" class="hidden p-5 rounded-2xl mb-8 text-white font-black shadow-xl animate-bounce"></div>
                    <div class="relative rounded-[2.5rem] overflow-hidden bg-black aspect-square max-w-sm mx-auto mb-10 shadow-2xl border-4 border-emerald-500/20"><div id="qrReader"></div></div>
                    <button id="btnManual" class="w-full py-5 bg-slate-900 text-white rounded-[1.5rem] font-black text-xs shadow-2xl flex items-center justify-center gap-4 hover:bg-black transition-all uppercase tracking-widest"><i class="fas fa-keyboard"></i> INPUT MANUAL</button>
                </div>
            `;
            
            // KONFIGURASI SCANNER TINGKAT TINGGI
            state.scanner = new Html5Qrcode("qrReader");
            
            const scanConfig = { 
                fps: 30, // Tingkatkan FPS agar lebih responsif (Sensitive)
                qrbox: (viewfinderWidth, viewfinderHeight) => {
                    // Responsive scanning box (70% dari ukuran terkecil)
                    const minEdge = Math.min(viewfinderWidth, viewfinderHeight);
                    return { width: Math.floor(minEdge * 0.7), height: Math.floor(minEdge * 0.7) };
                },
                aspectRatio: 1.0,
                // Optimasi: Hanya deteksi QR Code (abaikan barcode belanja) untuk performa maksimal
                formatsToSupport: [ Html5QrcodeSupportedFormats.QR_CODE ],
                experimentalFeatures: {
                    useBarCodeDetectorIfSupported: true // Gunakan Hardware Acceleration jika tersedia (Laptop/HP Modern)
                }
            };

            state.scanner.start(
                { facingMode: "environment" }, 
                scanConfig, 
                (text) => handleScanProcess(text.trim().toUpperCase(), type)
            ).catch(e => {
                console.error("Scanner Error:", e);
                // Fallback jika kamera gagal (opsional)
            });

            const manualBtn = document.getElementById('btnManual');
            if(manualBtn) manualBtn.onclick = () => { const code = prompt("Masukkan Kode (MN-XXXX):"); if (code) handleScanProcess(code.trim().toUpperCase(), type); };
        };
